var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},rogue;(function(n){(function(t){var i=function(t){function i(n,i,r,u){t.call(this,n,i,r),this.exploredTilesHashMap=[],this.saveExploredTiles=!0,this.visiblePoints=[],this.exploredTiles=[],this.viewDistance=u}return __extends(i,t),i.prototype.getSurroundingTiles=function(i,r,u){var e=t.prototype.getSurroundingTiles.call(this,i,r,u),f=i.clone();return f.x-=this.getOffsetX(),f.y-=this.getOffsetY(),this.calculateLight(e,new n.geom.Point(f.y,f.x)),this.applyLight(e,this.visiblePoints),this.saveExploredTiles||this.clear(),this.tiles},i.prototype.applyLight=function(n,t){for(var f=n[0].length,e=n.length,r,u,i=0;i<e;i++)for(r=0;r<f;r++)u=this.getTileID(r,i),this.visiblePoints.indexOf(u)==-1&&(n[i][r]=this.exploredTilesHashMap[u]||this._revealAll?n[i][r]=="?"?"#":"?":"*");t.length=0},i.prototype.calculateLight=function(n,t){for(var r=n.length,u=n[0].length,i=0;i<u;i++)this.rayTrace(t.x,t.y,0,i,n),this.rayTrace(t.x,t.y,r-1,i,n);for(i=0;i<r;i++)this.rayTrace(t.x,t.y,i,0,n),this.rayTrace(t.x,t.y,i,u-1,n)},i.prototype.rayTrace=function(n,t,i,r,u){var e=Math.abs(i-n),o=Math.abs(r-t),h=n,c=t,f=this.viewDistance,l=i>n?1:-1,a=r>t?1:-1,s=e-o,v;for(e*=2,o*=2;f>0;--f)v=this.visit(h,c,u,f),v&&(f=0),s>0?(h+=l,s-=o):(c+=a,s+=e)},i.prototype.visit=function(n,t,i){n<0&&(n=0),n>i.length-1&&(n=i.length-1),t<0&&(t=0),t>i[0].length-1&&(t=i[0].length-1);var f=i[n][t],u=this.getTileID(t,n);return this.visiblePoints.indexOf(u)==-1&&this.visiblePoints.push(u),this._tourchMode&&this._fullLineOfSight||this.exploredTilesHashMap[u]||f=="#"||(this.exploredTilesHashMap[u]=" ",this.exploredTiles.push(u)),f=="#"?!0:!1},i.prototype.clear=function(){this.exploredTilesHashMap.length=0,this.exploredTiles.length=0},i.prototype.revealAll=function(n){this._revealAll=n},i.prototype.tourchMode=function(n){this._tourchMode=n},i.prototype.fullLineOfSight=function(n){this._fullLineOfSight=n},i.prototype.getVisitedTiles=function(){return this.exploredTiles.length},i.prototype.getExploredTiles=function(){return this.exploredTiles},i}(t.MapSelection);t.FogOfWarMapSelection=i})(n.map||(n.map={}));var t=n.map})(rogue||(rogue={}))